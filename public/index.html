<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#075E54">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>✨ دردشة الأصدقاء - واتساب ويب</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'whatsapp': {
                            'green': {
                                'light': '#25D366',
                                'DEFAULT': '#075E54',
                                'dark': '#054D44'
                            },
                            'teal': '#128C7E',
                            'blue': '#34B7F1'
                        }
                    },
                    fontFamily: {
                        'sans': ['Segoe UI', 'Helvetica Neue', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        /* تخصيصات واتساب */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
        }
        
        /* تأثيرات واتساب */
        .whatsapp-gradient {
            background: linear-gradient(135deg, #075E54 0%, #128C7E 100%);
        }
        
        .whatsapp-green-gradient {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        }
        
        .whatsapp-blue-gradient {
            background: linear-gradient(135deg, #34B7F1 0%, #128C7E 100%);
        }
        
        /* رسائل المتحدثين */
        .message-sent {
            background: #DCF8C6;
            border-radius: 18px 4px 18px 18px;
            margin-left: auto;
            max-width: 80%;
        }
        
        .message-received {
            background: #FFFFFF;
            border-radius: 4px 18px 18px 18px;
            margin-right: auto;
            max-width: 80%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* مؤشر الكتابة */
        .typing-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
        }
        
        .typing-indicator span {
            height: 6px;
            width: 6px;
            float: left;
            margin: 0 1px;
            background-color: #9E9EA1;
            display: block;
            border-radius: 50%;
            opacity: 0.4;
        }
        
        .typing-indicator span:nth-of-type(1) {
            animation: 1s blink infinite 0.3333s;
        }
        
        .typing-indicator span:nth-of-type(2) {
            animation: 1s blink infinite 0.6666s;
        }
        
        .typing-indicator span:nth-of-type(3) {
            animation: 1s blink infinite 0.9999s;
        }
        
        @keyframes blink {
            50% {
                opacity: 1;
            }
        }
        
        /* شريط التمرير */
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }
        
        /* مؤشر الوضع المحمول */
        .status-dot {
            width: 10px;
            height: 10px;
            border: 2px solid white;
            box-shadow: 0 0 0 1px #25D366;
        }
        
        /* تأثيرات اللمس */
        .touch-feedback:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        /* صوتيات واتساب */
        .voice-message {
            background: #E8F5E9;
            border: 1px solid #C8E6C9;
        }
        
        /* رسالة قراءة */
        .message-read {
            color: #4FC3F7;
        }
        
        /* الوقت في الرسالة */
        .message-time {
            font-size: 11px;
            color: rgba(0, 0, 0, 0.45);
        }
        
        /* تباين عالي للأجهزة المحمولة */
        @media (prefers-contrast: high) {
            .message-sent {
                background: #C5E1A5;
            }
            
            .message-received {
                background: #FAFAFA;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            }
        }
        
        /* تحسينات للأجهزة الصغيرة */
        @media (max-width: 640px) {
            .message-sent,
            .message-received {
                max-width: 85%;
            }
            
            .voice-message {
                min-width: 200px;
            }
        }
        
        /* إخفاء الأزرار عند عدم الحاجة */
        .hide-on-mobile {
            display: none;
        }
        
        @media (min-width: 768px) {
            .hide-on-mobile {
                display: flex;
            }
        }
        
        /* تحسينات اللمس */
        @media (hover: none) and (pointer: coarse) {
            button, 
            .touchable {
                min-height: 44px;
                min-width: 44px;
            }
            
            input, 
            textarea {
                font-size: 16px !important; /* منع التكبير في iOS */
            }
        }
        
        /* الرسائل الفارغة */
        .empty-state {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7ec 100%);
        }
        
        /* تأثيرات الظل لواتساب */
        .whatsapp-shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.12);
        }
        
        /* حاوية الرسائل */
        .messages-container {
            background: #ECE5DD;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d1d7db' fill-opacity='0.15' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        /* تصميم زر الميكروفون */
        .mic-button {
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(37, 211, 102, 0.3);
        }
        
        .mic-button:active {
            transform: scale(0.9);
            box-shadow: 0 1px 5px rgba(37, 211, 102, 0.2);
        }
        
        /* شريط التسجيل */
        .recording-bar {
            animation: recordingPulse 1.5s infinite;
        }
        
        @keyframes recordingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* أزرار الرسائل */
        .message-actions {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .message-container:hover .message-actions {
            opacity: 1;
        }
        
        /* تحسينات للأجهزة ذات الشاشات الصغيرة جداً */
        @media (max-width: 320px) {
            .message-sent,
            .message-received {
                max-width: 90%;
                padding: 10px 12px;
            }
            
            .user-avatar {
                width: 36px;
                height: 36px;
            }
        }
        
        /* وضع الأفقي للجوال */
        @media (orientation: landscape) and (max-height: 500px) {
            .chat-header {
                height: 60px !important;
            }
            
            .chat-input-container {
                height: 70px !important;
            }
            
            #chat-messages {
                max-height: calc(100vh - 130px) !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">
    <!-- تطبيق الدردشة الرئيسي -->
    <div class="h-screen flex flex-col bg-white overflow-hidden">
        
        <!-- شريط الحالة للجوال -->
        <div class="lg:hidden h-6 bg-whatsapp-green"></div>
        
        <!-- الهيدر الرئيسي -->
        <header class="bg-whatsapp-green text-white px-4 py-3 shadow-lg">
            <div class="flex items-center justify-between">
                <!-- الجزء الأيمن: معلومات المجموعة -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- زر القائمة للجوال -->
                    <button id="mobile-menu-btn" class="lg:hidden touch-feedback p-2 rounded-full hover:bg-whatsapp-teal/20">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    
                    <!-- صورة المجموعة -->
                    <div class="relative">
                        <div class="w-10 h-10 lg:w-12 lg:h-12 rounded-full bg-gradient-to-br from-whatsapp-blue to-whatsapp-green flex items-center justify-center">
                            <i class="fas fa-users text-white text-lg lg:text-xl"></i>
                        </div>
                        <div class="absolute -bottom-1 -right-1 status-dot bg-green-400 rounded-full"></div>
                    </div>
                    
                    <!-- معلومات المجموعة -->
                    <div>
                        <h1 class="font-bold text-lg">مجموعة الدردشة</h1>
                        <div class="flex items-center text-sm text-green-100">
                            <div id="connection-status" class="flex items-center">
                                <span class="h-2 w-2 bg-green-300 rounded-full ml-1 animate-pulse"></span>
                                <span class="text-xs">جاري الاتصال...</span>
                            </div>
                            <span class="mx-2">•</span>
                            <span class="text-xs" id="online-count">3 متصلون</span>
                        </div>
                    </div>
                </div>
                
                <!-- الجزء الأيسر: أزرار التحكم -->
                <div class="flex items-center space-x-2 space-x-reverse">
                    <!-- زر البحث (للكمبيوتر فقط) -->
                    <button class="hide-on-mobile touch-feedback p-3 rounded-full hover:bg-whatsapp-teal/20">
                        <i class="fas fa-search"></i>
                    </button>
                    
                    <!-- زر الإشعارات -->
                    <button onclick="toggleSound()" class="touch-feedback p-3 rounded-full hover:bg-whatsapp-teal/20" id="sound-btn">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    
                    <!-- زر القائمة (للكمبيوتر فقط) -->
                    <button class="hide-on-mobile touch-feedback p-3 rounded-full hover:bg-whatsapp-teal/20">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- المحتوى الرئيسي -->
        <div class="flex flex-1 overflow-hidden">
            
            <!-- القائمة الجانبية للاتصالات (للكمبيوتر فقط) -->
            <div class="hidden lg:block w-80 border-l border-gray-200 bg-white overflow-hidden">
                <!-- رأس قائمة الاتصالات -->
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">المحادثات</h2>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button class="touch-feedback p-2 rounded-full hover:bg-gray-100">
                                <i class="fas fa-edit text-gray-600"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- شريط البحث -->
                    <div class="relative">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input 
                            type="text" 
                            placeholder="بحث في المحادثات"
                            class="w-full pr-10 pl-4 py-2 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-whatsapp-green focus:bg-white"
                        >
                    </div>
                </div>
                
                <!-- قائمة المستخدمين -->
                <div class="overflow-y-auto h-[calc(100vh-140px)] scrollbar-thin">
                    <div id="users-list" class="divide-y divide-gray-100">
                        <!-- سيتم ملؤه بالـ JavaScript -->
                    </div>
                    
                    <!-- اختيار المستخدم -->
                    <div class="p-4 border-t border-gray-200">
                        <h3 class="font-semibold text-gray-700 mb-3">اختر شخصيتك:</h3>
                        <div class="space-y-2">
                            <button onclick="selectUser('حسن')" class="user-select-btn w-full p-3 rounded-lg hover:bg-gray-50 active:bg-gray-100 border border-gray-200 text-right transition-all duration-200 touch-feedback">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center text-white font-bold ml-3">
                                        ح
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-800">حسن</div>
                                        <div class="text-xs text-gray-500">متصل الآن</div>
                                    </div>
                                    <i class="fas fa-chevron-left text-gray-400 text-sm"></i>
                                </div>
                            </button>
                            
                            <button onclick="selectUser('حاتم')" class="user-select-btn w-full p-3 rounded-lg hover:bg-gray-50 active:bg-gray-100 border border-gray-200 text-right transition-all duration-200 touch-feedback">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold ml-3">
                                        ح
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-800">حاتم</div>
                                        <div class="text-xs text-gray-500">متصل الآن</div>
                                    </div>
                                    <i class="fas fa-chevron-left text-gray-400 text-sm"></i>
                                </div>
                            </button>
                            
                            <button onclick="selectUser('مشاري')" class="user-select-btn w-full p-3 rounded-lg hover:bg-gray-50 active:bg-gray-100 border border-gray-200 text-right transition-all duration-200 touch-feedback">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold ml-3">
                                        م
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-800">مشاري</div>
                                        <div class="text-xs text-gray-500">متصل الآن</div>
                                    </div>
                                    <i class="fas fa-chevron-left text-gray-400 text-sm"></i>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- منطقة الدردشة الرئيسية -->
            <div class="flex-1 flex flex-col overflow-hidden">
                
                <!-- منطقة الرسائل -->
                <div id="chat-messages" class="messages-container flex-1 overflow-y-auto p-4 scrollbar-thin">
                    <!-- الرسالة الترحيبية -->
                    <div class="flex flex-col items-center justify-center h-full empty-state">
                        <div class="text-center max-w-md p-8 rounded-2xl bg-white/80 backdrop-blur-sm shadow-lg">
                            <div class="w-20 h-20 rounded-full bg-gradient-to-r from-whatsapp-green to-whatsapp-teal flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-comments text-white text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-3">مرحباً في الدردشة</h2>
                            <p class="text-gray-600 mb-6">
                                اختر مستخدم من القائمة لبدء المحادثة. يمكنك إرسال رسائل نصية أو صوتية مثل واتساب!
                            </p>
                            <div class="space-y-3">
                                <button onclick="selectUser('حسن')" class="w-full p-4 rounded-xl bg-gradient-to-r from-red-50 to-white border border-red-100 hover:border-red-300 hover:shadow-md transition-all text-right active:scale-95 touch-feedback">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center text-white font-bold">
                                                ح
                                            </div>
                                            <div class="mr-3">
                                                <div class="font-bold text-gray-800">حسن</div>
                                                <div class="text-xs text-gray-500">متصل الآن</div>
                                            </div>
                                        </div>
                                        <i class="fas fa-chevron-left text-red-400"></i>
                                    </div>
                                </button>
                                
                                <button onclick="selectUser('حاتم')" class="w-full p-4 rounded-xl bg-gradient-to-r from-green-50 to-white border border-green-100 hover:border-green-300 hover:shadow-md transition-all text-right active:scale-95 touch-feedback">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold">
                                                ح
                                            </div>
                                            <div class="mr-3">
                                                <div class="font-bold text-gray-800">حاتم</div>
                                                <div class="text-xs text-gray-500">متصل الآن</div>
                                            </div>
                                        </div>
                                        <i class="fas fa-chevron-left text-green-400"></i>
                                    </div>
                                </button>
                                
                                <button onclick="selectUser('مشاري')" class="w-full p-4 rounded-xl bg-gradient-to-r from-purple-50 to-white border border-purple-100 hover:border-purple-300 hover:shadow-md transition-all text-right active:scale-95 touch-feedback">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold">
                                                م
                                            </div>
                                            <div class="mr-3">
                                                <div class="font-bold text-gray-800">مشاري</div>
                                                <div class="text-xs text-gray-500">متصل الآن</div>
                                            </div>
                                        </div>
                                        <i class="fas fa-chevron-left text-purple-400"></i>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- منطقة إدخال الرسائل -->
                <div class="chat-input-container bg-gray-50 border-t border-gray-200 p-3 lg:p-4">
                    <!-- مؤشر التسجيل -->
                    <div id="voice-recording-container" class="hidden mb-3 bg-white rounded-xl shadow-md p-4 animate__animated animate__fadeIn">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center mr-3 recording-bar">
                                    <i class="fas fa-microphone text-white"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-red-700">جاري التسجيل...</div>
                                    <div class="text-xs text-red-600">
                                        <i class="fas fa-clock ml-1"></i>
                                        <span id="recording-timer">00:00</span> / 01:00
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse animation-delay-200"></div>
                                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse animation-delay-400"></div>
                                </div>
                                <button id="send-voice-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors active:scale-95 touch-feedback">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <button id="cancel-voice-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors active:scale-95 touch-feedback">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- شريط الأدوات -->
                    <div class="flex items-center space-x-2 space-x-reverse mb-3">
                        <!-- زر الإيموجي -->
                        <button id="emoji-toggle" class="touch-feedback p-3 rounded-full hover:bg-gray-200 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-smile text-xl"></i>
                        </button>
                        
                        <!-- قائمة الإيموجي -->
                        <div id="emoji-picker" class="hidden absolute bottom-20 right-4 bg-white border border-gray-300 rounded-2xl shadow-2xl z-50 w-80 h-80">
                            <div class="p-3 border-b flex justify-between items-center bg-gray-50 rounded-t-2xl">
                                <span class="font-bold text-gray-800">الإيموجي</span>
                                <button id="close-emoji" class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div id="emoji-grid" class="p-3 overflow-y-auto h-64 grid grid-cols-8 gap-2">
                                <!-- سيتم ملؤه بالـ JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- منطقة الإدخال -->
                    <div class="flex items-end space-x-2 space-x-reverse">
                        <!-- زر الميكروفون -->
                        <button id="voice-record-btn" class="touch-feedback p-3 rounded-full bg-whatsapp-green hover:bg-whatsapp-teal text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors mic-button">
                            <i class="fas fa-microphone text-xl"></i>
                        </button>
                        
                        <!-- حقل إدخال النص -->
                        <div class="flex-1 bg-white rounded-full border border-gray-300 focus-within:border-whatsapp-green focus-within:ring-2 focus-within:ring-whatsapp-green/20">
                            <div class="flex items-center px-3 py-2">
                                <textarea 
                                    id="message-input" 
                                    placeholder="اكتب رسالة..."
                                    class="flex-1 border-0 focus:ring-0 focus:outline-none resize-none max-h-32 text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"
                                    rows="1"
                                    disabled
                                ></textarea>
                                
                                <!-- عداد الأحرف -->
                                <div class="text-xs text-gray-500 ml-2">
                                    <span id="char-count">0</span>/500
                                </div>
                            </div>
                        </div>
                        
                        <!-- زر الإرسال -->
                        <button 
                            id="send-btn" 
                            class="touch-feedback p-3 rounded-full bg-whatsapp-green hover:bg-whatsapp-teal text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            disabled
                        >
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    
                    <!-- حالة المستخدم -->
                    <div class="mt-2 text-center">
                        <div class="inline-flex items-center bg-white/80 backdrop-blur-sm px-3 py-1 rounded-full text-xs text-gray-600">
                            <div class="w-2 h-2 bg-green-500 rounded-full ml-1 animate-pulse"></div>
                            <span id="selected-user-display" class="font-medium">لم تختر مستخدمًا بعد</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- القائمة الجانبية للجوال -->
    <div id="mobile-sidebar" class="fixed top-0 right-0 bottom-0 z-50 w-full max-w-sm bg-white shadow-2xl transform translate-x-full transition-transform duration-300 lg:hidden">
        <div class="h-full flex flex-col">
            <!-- رأس القائمة -->
            <div class="whatsapp-gradient p-5">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold text-white">
                        <i class="fas fa-users ml-2"></i>
                        الأعضاء
                    </h2>
                    <button id="close-mobile-menu" class="text-white p-2">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- محتوى القائمة -->
            <div class="flex-grow overflow-y-auto p-5">
                <div id="mobile-users-list" class="space-y-4 mb-6">
                    <!-- سيتم ملؤه بالـ JavaScript -->
                </div>
                
                <!-- اختيار المستخدم -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">اختر شخصيتك:</h3>
                    <div class="space-y-3">
                        <button onclick="selectUser('حسن')" class="user-select-btn w-full p-4 rounded-xl text-right transition-all duration-300 active:scale-95 touch-feedback bg-gradient-to-l from-red-50 to-white border border-red-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center text-white font-bold">
                                        ح
                                    </div>
                                    <div class="mr-3">
                                        <div class="font-bold text-gray-800">حسن</div>
                                        <div class="text-xs text-gray-500">متصل الآن</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-left text-red-400"></i>
                            </div>
                        </button>
                        
                        <button onclick="selectUser('حاتم')" class="user-select-btn w-full p-4 rounded-xl text-right transition-all duration-300 active:scale-95 touch-feedback bg-gradient-to-l from-green-50 to-white border border-green-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold">
                                        ح
                                    </div>
                                    <div class="mr-3">
                                        <div class="font-bold text-gray-800">حاتم</div>
                                        <div class="text-xs text-gray-500">متصل الآن</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-left text-green-400"></i>
                            </div>
                        </button>
                        
                        <button onclick="selectUser('مشاري')" class="user-select-btn w-full p-4 rounded-xl text-right transition-all duration-300 active:scale-95 touch-feedback bg-gradient-to-l from-purple-50 to-white border border-purple-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold">
                                        م
                                    </div>
                                    <div class="mr-3">
                                        <div class="font-bold text-gray-800">مشاري</div>
                                        <div class="text-xs text-gray-500">متصل الآن</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-left text-purple-400"></i>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- نافذة الترحيب -->
    <div id="welcome-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 hidden animate__animated p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm mx-auto overflow-hidden animate__animated animate__zoomIn">
            <div class="whatsapp-gradient p-6 text-center">
                <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-comments text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white">مرحباً في الدردشة!</h3>
                <p class="text-white/90 mt-2">اختر مستخدم لبدء المحادثة</p>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    <button onclick="selectUser('حسن')" class="w-full p-4 rounded-xl active:scale-95 touch-feedback bg-gradient-to-l from-red-50 to-white border border-red-200 text-right">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center text-white font-bold">
                                    ح
                                </div>
                                <div class="mr-3">
                                    <div class="font-bold text-gray-800">حسن</div>
                                    <div class="text-xs text-gray-500">اللون: أحمر</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-left text-red-400"></i>
                        </div>
                    </button>
                    
                    <button onclick="selectUser('حاتم')" class="w-full p-4 rounded-xl active:scale-95 touch-feedback bg-gradient-to-l from-green-50 to-white border border-green-200 text-right">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold">
                                    ح
                                </div>
                                <div class="mr-3">
                                    <div class="font-bold text-gray-800">حاتم</div>
                                    <div class="text-xs text-gray-500">اللون: أخضر</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-left text-green-400"></i>
                        </div>
                    </button>
                    
                    <button onclick="selectUser('مشاري')" class="w-full p-4 rounded-xl active:scale-95 touch-feedback bg-gradient-to-l from-purple-50 to-white border border-purple-200 text-right">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold">
                                    م
                                </div>
                                <div class="mr-3">
                                    <div class="font-bold text-gray-800">مشاري</div>
                                    <div class="text-xs text-gray-500">اللون: بنفسجي</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-left text-purple-400"></i>
                        </div>
                    </button>
                </div>
                <div class="mt-6 p-4 bg-gray-50 rounded-xl">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center ml-3">
                            <i class="fas fa-microphone text-green-600"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800">نصيحة:</h4>
                            <p class="text-sm text-gray-600">اضغط مع الاستمرار على زر الميكروفون للتسجيل الصوتي</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- زر العودة للأعلى للجوال -->
    <button id="scroll-to-top" class="fixed bottom-20 left-4 z-30 bg-whatsapp-green text-white w-10 h-10 rounded-full shadow-lg hidden items-center justify-center transition-all duration-300 active:scale-95 touch-feedback">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="/socket.io/socket.io.js"></script>
    <script src="main.js"></script>
    <script>
        // تهيئة إضافية للصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // تحديث الوقت
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('ar-SA', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }
            updateTime();
            
            // عداد الأحرف
            const messageInput = document.getElementById('message-input');
            const charCount = document.getElementById('char-count');
            
            if (messageInput && charCount) {
                messageInput.addEventListener('input', function() {
                    charCount.textContent = this.value.length;
                    if (this.value.length > 500) {
                        charCount.classList.add('text-red-500');
                    } else {
                        charCount.classList.remove('text-red-500');
                    }
                    
                    // تعديل ارتفاع مربع النص تلقائياً
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
            }
            
            // عرض نافذة الترحيب
            setTimeout(() => {
                const welcomeModal = document.getElementById('welcome-modal');
                if (welcomeModal && !localStorage.getItem('welcomeShown')) {
                    welcomeModal.classList.remove('hidden');
                    welcomeModal.classList.add('animate__zoomIn');
                    localStorage.setItem('welcomeShown', 'true');
                }
            }, 1000);
            
            // إغلاق نافذة الترحيب
            document.getElementById('welcome-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });
            
            // التحكم في القائمة الجانبية للجوال
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const closeMobileMenu = document.getElementById('close-mobile-menu');
            const mobileSidebar = document.getElementById('mobile-sidebar');
            
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileSidebar.classList.remove('translate-x-full');
                    document.body.style.overflow = 'hidden';
                });
            }
            
            if (closeMobileMenu) {
                closeMobileMenu.addEventListener('click', () => {
                    mobileSidebar.classList.add('translate-x-full');
                    document.body.style.overflow = 'auto';
                });
            }
            
            // إغلاق القائمة عند النقر خارجها
            mobileSidebar.addEventListener('click', (e) => {
                if (e.target === mobileSidebar) {
                    mobileSidebar.classList.add('translate-x-full');
                    document.body.style.overflow = 'auto';
                }
            });
            
            // زر العودة للأعلى
            const scrollToTopBtn = document.getElementById('scroll-to-top');
            
            window.addEventListener('scroll', () => {
                const chatMessages = document.getElementById('chat-messages');
                if (chatMessages && chatMessages.scrollTop > 300) {
                    scrollToTopBtn.classList.remove('hidden');
                } else {
                    scrollToTopBtn.classList.add('hidden');
                }
            });
            
            if (scrollToTopBtn) {
                scrollToTopBtn.addEventListener('click', () => {
                    const chatMessages = document.getElementById('chat-messages');
                    if (chatMessages) {
                        chatMessages.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    }
                });
            }
            
            // إغلاق قائمة الإيموجي
            document.addEventListener('click', (e) => {
                const emojiPicker = document.getElementById('emoji-picker');
                const emojiToggle = document.getElementById('emoji-toggle');
                
                if (emojiPicker && !emojiPicker.classList.contains('hidden')) {
                    if (!emojiPicker.contains(e.target) && !emojiToggle.contains(e.target)) {
                        emojiPicker.classList.add('hidden');
                    }
                }
            });
            
            // تعريف دوال عامة
            window.toggleSound = function() {
                const soundBtn = document.getElementById('sound-btn');
                const icon = soundBtn.querySelector('i');
                if (icon.classList.contains('fa-volume-up')) {
                    icon.classList.remove('fa-volume-up');
                    icon.classList.add('fa-volume-mute');
                } else {
                    icon.classList.remove('fa-volume-mute');
                    icon.classList.add('fa-volume-up');
                }
            };
            
            window.clearChat = function() {
                if (confirm('هل تريد مسح شاشة الدردشة؟')) {
                    const chatMessages = document.getElementById('chat-messages');
                    chatMessages.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full empty-state">
                            <div class="text-center max-w-md p-8 rounded-2xl bg-white/80 backdrop-blur-sm shadow-lg">
                                <div class="w-20 h-20 rounded-full bg-gradient-to-r from-whatsapp-green to-whatsapp-teal flex items-center justify-center mx-auto mb-6">
                                    <i class="fas fa-broom text-white text-3xl"></i>
                                </div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-3">تم مسح الشاشة</h2>
                                <p class="text-gray-600">اكتب رسالة جديدة لبدء المحادثة!</p>
                            </div>
                        </div>
                    `;
                }
            };
            
            // إضافة تأثيرات CSS للرسوم المتحركة
            const style = document.createElement('style');
            style.textContent = `
                .animation-delay-200 { animation-delay: 0.2s; }
                .animation-delay-400 { animation-delay: 0.4s; }
                .animation-delay-600 { animation-delay: 0.6s; }
                
                /* تحسينات لللمس على الجوال */
                @media (hover: none) and (pointer: coarse) {
                    #emoji-picker {
                        bottom: 80px;
                        right: 10px;
                        width: calc(100vw - 20px);
                    }
                }
                
                /* تحسينات للأجهزة الصغيرة جداً */
                @media (max-width: 320px) {
                    .chat-input-container {
                        padding: 12px;
                    }
                    
                    #emoji-toggle, #voice-record-btn, #send-btn {
                        padding: 10px;
                    }
                }
                
                /* تحسينات للأوضاع الرأسية والأفقية */
                @media (orientation: landscape) and (max-height: 500px) {
                    .chat-input-container {
                        flex-direction: row;
                        align-items: center;
                    }
                    
                    #message-input {
                        max-height: 80px;
                    }
                }
                
                /* تحسينات شريط التمرير */
                #chat-messages::-webkit-scrollbar {
                    width: 4px;
                }
                
                #chat-messages::-webkit-scrollbar-track {
                    background: transparent;
                }
                
                #chat-messages::-webkit-scrollbar-thumb {
                    background: rgba(0, 0, 0, 0.1);
                    border-radius: 2px;
                }
                
                /* تحسينات لوضع التكبير */
                @media (max-width: 640px) {
                    body {
                        -webkit-text-size-adjust: 100%;
                    }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
